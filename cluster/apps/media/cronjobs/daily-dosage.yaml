---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: daily-dosage
  namespace: media
spec:
  schedule: "14 02 * * *"
  concurrencyPolicy: Replace
  successfulJobsHistoryLimit: 1
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: dosage
              image: ghcr.io/davralin/dosage:latest@sha256:c00fe9482c9b7d4e02c467136a179d49cc87b0b181a8aafeb39432927c5ecf3f
              args:
                - dosage
                - -b
                - /srv
                - --adult
                - --all
                - --continue
                - --no-downscale
                - --parallel
                - '10'
                - '@'
              volumeMounts:
                - mountPath: /srv
                  subPath: images/webcomics
                  name: media
          restartPolicy: Never
          volumes:
            - name: media
              persistentVolumeClaim:
                claimName: media
